-- 1. Create campaigns table
create table if not exists public.campaigns (
  id text not null primary key,
  name text not null,
  status text not null default 'active',
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  target_job_title text,
  target_location text
);

-- 2. Create leads table
create table if not exists public.leads (
  id text not null primary key,
  campaign_id text references public.campaigns(id),
  first_name text,
  last_name text,
  headline text,
  company text,
  title text,
  location text,
  linkedin_url text,
  email text,
  email_status text,
  stage text,
  status text,
  scraped_at timestamp with time zone default timezone('utc'::text, now()) not null,
  avatar_url text,
  summary text,
  ai_score numeric,
  ai_reasoning text,
  lemlist_synced boolean default false,
  lemlist_id text,
  lemlist_contact_id text
);

-- 3. Enable Row Level Security (RLS) is good practice, 
-- but we will create open policies for this demo so it works immediately without auth setup.
alter table public.campaigns enable row level security;
alter table public.leads enable row level security;

-- 4. Create policies to allow access (Modify these for production!)
-- Campaigns Policies
create policy "Enable read access for all users" on public.campaigns for select using (true);
create policy "Enable insert access for all users" on public.campaigns for insert with check (true);
create policy "Enable update access for all users" on public.campaigns for update using (true);

-- Leads Policies
create policy "Enable read access for all users" on public.leads for select using (true);
create policy "Enable insert access for all users" on public.leads for insert with check (true);
create policy "Enable update access for all users" on public.leads for update using (true);

-- 5. Add new columns for Lemlist integration (run this if updating existing schema)
-- alter table public.leads add column if not exists lemlist_id text;
-- alter table public.leads add column if not exists lemlist_contact_id text;